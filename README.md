# TGS Gap Filler

[![DOI](https://zenodo.org/badge/183120917.svg)](https://zenodo.org/badge/latestdoi/183120917)

A gap filling tool that uses error-prone long reads generated by third-generation-sequence techniques (Pacbio, Oxford Nanopore, etc.) or preassembled contigs to fill N-gap in the genome assembly.

- Both raw reads and pre-error-corrected reads are acceptable as input.

- If only raw long reads are provided, it polishes raw TGS reads by calling Racon.

- If additional NGS short reads are available, it polishes raw TGS reads by calling Pilon.

## Installation

### Download 
```
git clone  https://github.com/BGI-Qingdao/TGSGapFiller.git YOUR-INSTALL-DIR
```

### Compile

#### configure minimap2

- If you have already installed a minimap2, then link it here

```
rm -rf YOUR-INSTALL-DIR/minimap2
ln -s MINIMAP2-PATH YOUR-INSTALL-DIR/
```
- Otherwise you need to download it by:

```
cd YOUR-INSTALL-DIR
git submodule init
git submodule update
```

#### compile main src

```
cd YOUR-INSTALL-DIR/main_src_ont
make
```

## Usage 

### basic usage 

```
Usage:
      TGSGapFiller --scaff SCAFF_FILE --reads TGS_READS_FILE --output OUT_PREFIX [options...]
      required:
          --scaff     <draft scaffolds>      input draft scaffolds.
          --reads     <TGS reads>     input TGS reads.
          --output    <output prefix>      output prefix.
     ## error correction module
          --ne                             do not execute error correction.
          or
          --racon     <racon>              installed racon. Can be installed following https://github.com/isovic/racon
          or
          --pilon     <pilon>              installed pilon jar package. Can be downloaded from https://github.com/broadinstitute/pilon/releases/download/v1.23/pilon-1.23.jar
          --java      <java>               installed java.
          --ngs       <ngs_reads>          input NGS reads used for pilon.
          --samtool   <samtool>            installed samtool.
          
          
      optional:
          --tgstype   <pb/ont>             TGS type. ont by default.
          --min_idy   <float>              minimum identity for filtering candidate sequences.
                                           0.3 for ont by default.
                                           0.2 for pb by default.
          --min_match <int>                minimum matched length for filtering candidate sequences.
                                           300 for ont by default.
                                           200 for pb by default.
          --thread    <int>                number of threads uesd. 16 by default.
          --pilon_mem <int>                memory used for pilon, passing to -Xmx.  can use “m” or “M” for MB, or “g” or “G” for GB. 300G by default.
          --chunk     <int>                split candidates into # of chunks to separately correct errors. 3 by default.
          --p_round   <int>                iteration number for pilon error-correction. 3 by default.
          --r_round   <int>                iteration number for racon error-correction. 1 by default.
```

### version without error correction 

* example

```
YOUR-INSTALL-DIR/TGSGapFiller.sh  \
        --scaff  scaffold-path/scaffold.fasta \
        --reads  tgs-reads-path/tgs.reads.fasta \
        --output test_ne  \
        --ne \
        >pipe.log 2>pipe.err
```

### version with error correction by racon

```
YOUR-INSTALL-DIR/TGSGapFiller.sh  \
        --scaff  scaffold-path/scaffold.fasta \
        --reads  tgs-reads-path/tgs.reads.fasta \
        --output test_racon \
        --racon  raconn-path/bin/racon \
        >pipe.log 2>pipe.err
```

### version with error correction by pilon

```
YOUR-INSTALL-DIR/TGSGapFiller.sh  \
        --scaff  scaffold-path/scaffold.fasta \
        --reads  tgs-reads-path/tgs.reads.fasta \
        --output test_pilon \
        --pilon  pilon-path/pilon-1.23.jar  \
        --ngs    ngs-reads-path/ngs.reads.fastq  \
        --samtool samtools-path/bin/samtools  \
        --java    java-path/bin/java \
        >pipe.log 2>pipe.err
```

### deal with pacbio input reads

* default thild-generation-reads type is ont , use ```--tgstype```  to change it .

```
    --tgstype ont
    or 
    --tgstype pb
```

* An example of use pacbio input reads and use racon to do error-correction

```
YOUR-INSTALL-DIR/TGSGapFiller.sh  \
        --scaff  scaffold-path/scaffold.fasta \
        --reads  tgs-reads-path/tgs.reads.fasta \
        --output test_racon \
        --racon  raconn-path/bin/racon \
        --tgstype pb \
        >pipe.log 2>pipe.err
```

## Output

- your-prefix.scaff_seq 
    - this is the final sequence after gap filling
- your-prefix.gap_fill_details
    - details about how the final sequence was assemblied 

### format of your-prefix.gap_fill_details

#### a example :

```
>scaffold_1
1	1000	S	1000	2000
1001	1010	N
1011	1100	S	2201	2290
1101	1110	F
1111	1200	S	2301	2390
>scaffold_2
......

```
#### detailed information

1. each scaffold name is followed by its data lines.
2. data line contains 3 or 5 columns and describes the source of a segments of the final sequence:
    - column 1 is the segment's first bp position at the final sequence.
    - column 2 is the segment's last bp position at the final sequence.
    - column 3 is the segment's type , 'S' , 'N' or 'F'.
        - 'S' means this segment is a segment of the input sequence and this line includes other 2 more columns :
            - column 4 is the segment's first bp position at the input sequence.
            - column 5 is the segment's last bp position at the input sequence.
        - 'N' means this segment is N area.
        - 'F' means this segment is a filled sequence from TGS reads .

